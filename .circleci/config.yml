version: 2
jobs:
  build:
    docker:
      - image: cimg/python:3.9
        environment:
          DIARIO_SECRET_KEY: django-insecure-41u6jo_*yg2=1tabsc8ul3-!m!n1hywuj9$t_bv*jb2ju+s9-3
          DIARIO_DEBUG: True
          DIARIO_ALLOWED_HOSTS: localhost
          DIARIO_DB_URL: postgres://postgres@localhost/postgres?sslmode=disable

      - image: circleci/postgres:9.6.2
        environment:
          POSTGRES_USER: postgres
          POSTGRES_DB: postgres

    steps:
      - checkout
      - run: 
          command: |            
            poetry install
      - run:
          name: Running tests
          command: |            
            poetry run web/manage.py test
      - store_artifacts:
          path: test-reports/
          destination: python_app